# ğŸ“› Name of the workflow as it appears in the GitHub Actions tab
name: upload-to-gcs

# ğŸš€ This workflow is triggered manually via the GitHub Actions UI
on:
  workflow_dispatch:

jobs:
  upload:  # ğŸ‘· Job ID (can be any name)
    runs-on: ubuntu-latest  # ğŸ’» Use GitHub's Ubuntu-based runner

    steps:
      # ğŸ§¾ Step 1: Checkout the repository code into the runner
      - name: Checkout repository
        uses: actions/checkout@v3  # âœ… Pulls the latest code from your branch

      # ğŸ Step 2: Set up Python environment
      - name: Set up Python
        uses: actions/setup-python@v4  # ğŸ“¦ Official GitHub Action to configure Python
        with:
          python-version: '3.11'  # ğŸ”¢ Specifies the version of Python to use

      # ğŸ“¦ Step 3: Install Python dependencies from requirements.txt
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip  # ğŸ” Upgrade pip to the latest version
          pip install -r requirements.txt      # ğŸ“¥ Install required Python packages

      # ğŸ§ª Step 4: Debug - Print current directory and structure
      # This helps verify your working directory and whether scripts/data are present
      - name: Debug - Print current directory and contents
        run: |
          pwd     # ğŸ“ Print current working directory
          ls -R   # ğŸ“‚ Recursively list all files and folders (for debugging)

      # ğŸ› Step 5 (Optional Debug): Check if FRED_API_KEY is properly loaded
      # âœ… Prints only partial info (first 5 characters and total length) to avoid leaking secrets
      - name: Debug - Echo partial FRED_API_KEY (do not log full key!)
        env:
          FRED_API_KEY: ${{ secrets.FRED_API_KEY }}  # ğŸ”’ Load secret from GitHub repo settings
        run: |
          echo "FRED_API_KEY first 5 chars: ${FRED_API_KEY:0:5}"   # ğŸ‘€ Partial key to verify correct secret loading
          echo "FRED_API_KEY length: ${#FRED_API_KEY}"             # ğŸ”¢ Length confirms key is non-empty

      # ğŸš¨ Step 6: Run your main data ingestion Python scripts
      - name: Run data ingestion scripts
        env:
          FRED_API_KEY: ${{ secrets.FRED_API_KEY }}  # ğŸ” Secret passed to environment variable
        run: |
          python scripts/download_housing_starts_fred_data.py       # ğŸ  Downloads housing data from FRED
          python scripts/fetching_additional_indicators.py          # ğŸ“Š Fetches macroeconomic indicators